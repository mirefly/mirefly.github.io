extends layout

mixin commitList(repo)
  -var MAX_COMMITS = 15
  -var commits = commitsByRepo[repo]
  -function formatDate(str) {
  -  var date = new Date(str)
  -  return date.toLocaleDateString('en-US', {month: 'short', day: 'numeric'})
  -}
  -function asterisk2br(str) {
  -  return str.replace(/\*/g, '<br />\*')
  -}
  -var classname = 'ul'+Math.random().toString(36).substring(2)

  ul(class=classname)
    each commit, index in commits
      li(style=index > MAX_COMMITS ? 'display:none':'')
        a(href=commit.htmlUrl) #{commit.sha.slice(0, 6)}
        p.date #{formatDate(commit.date)}
        p.message!= asterisk2br(commit.message)
    if commitsByRepo[repo].length > MAX_COMMITS
      li
        a(onclick='showAll(this, "#{classname}")' style='cursor: pointer') More...

mixin repoNameAndCommitsNum(repo)
  h4
    a(href='https://github.com/'+repo) #{repo}
    &nbsp
    a(href='https://github.com/'+repo+'/commits?author=mirefly') (#{commitsByRepo[repo].length} PRs)

block main
  section
    h4
      a(href='https://github.com/mirefly/mysite') This website

  section
    +repoNameAndCommitsNum('mozilla/addons-code-manager')
    +commitList('mozilla/addons-code-manager')

  section
    +repoNameAndCommitsNum('mozilla/addons-frontend')
    +commitList('mozilla/addons-frontend')

  section
    +repoNameAndCommitsNum('mozilla/addons-server')
    +commitList('mozilla/addons-server')

  section
    +repoNameAndCommitsNum('mozilla/fxa')
    +commitList('mozilla/fxa')

  section
    +repoNameAndCommitsNum('mozilla/application-services')
    +commitList('mozilla/application-services')
